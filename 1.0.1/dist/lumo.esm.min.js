const MODAL_DURATION=300;export class Modal{constructor(element,options={}){this.el=typeof element==="string"?document.querySelector(element):element;this.body=this.el.querySelector("section");this.isLocked=this.el.hasAttribute("data-locked")||options.locked;this.previousFocus=null;this.focusableElements=null}
async open(){if(this.el.hasAttribute("open"))return;this.previousFocus=document.activeElement;this.el.setAttribute("open","open");this.el.setAttribute("role","dialog");this.el.setAttribute("aria-modal","true");this._setSiblingsAriaHidden(!0);await this._animate("open");this._updateFocusableElements();this._focusFirstElement();this._addFocusTrap()}
async close(){if(!this.el.hasAttribute("open"))return;this._removeFocusTrap();await this._animate("close");this.el.removeAttribute("open");this.el.removeAttribute("role");this.el.removeAttribute("aria-modal");this._setSiblingsAriaHidden(!1);if(this.previousFocus&&typeof this.previousFocus.focus==="function"){this.previousFocus.focus()}}
_animate(direction){return new Promise((resolve)=>{const isOpening=direction==="open";const opacity=new Animation(new KeyframeEffect(this.el,[{opacity:isOpening?0:1},{opacity:isOpening?1:0}],{duration:MODAL_DURATION,easing:"ease"}),document.timeline);const move=new Animation(new KeyframeEffect(this.body,[{transform:`translateY(${isOpening ? "-3rem" : "0"})`},{transform:`translateY(${isOpening ? "0" : "-3rem"})`}],{duration:MODAL_DURATION,easing:"ease"}),document.timeline,);opacity.onfinish=resolve;opacity.play();move.play()})}
_updateFocusableElements(){const focusableSelectors='a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])';this.focusableElements=Array.from(this.el.querySelectorAll(focusableSelectors))}
_focusFirstElement(){if(this.focusableElements&&this.focusableElements.length>0){this.focusableElements[0].focus()}else{this.el.setAttribute("tabindex","-1");this.el.focus()}}
_addFocusTrap(){this._focusTrapHandler=(e)=>{if(e.key==="Tab"){if(!this.focusableElements||this.focusableElements.length===0){e.preventDefault();return}
const firstElement=this.focusableElements[0];const lastElement=this.focusableElements[this.focusableElements.length-1];if(e.shiftKey&&document.activeElement===firstElement){e.preventDefault();lastElement.focus()}else if(!e.shiftKey&&document.activeElement===lastElement){e.preventDefault();firstElement.focus()}}else if(e.key==="Escape"&&!this.isLocked){e.preventDefault();this.close()}};this.el.addEventListener("keydown",this._focusTrapHandler)}
_removeFocusTrap(){if(this._focusTrapHandler){this.el.removeEventListener("keydown",this._focusTrapHandler)}}
_setSiblingsAriaHidden(hidden){const siblings=Array.from(document.body.children).filter((child)=>child!==this.el&&child.tagName!=="SCRIPT");siblings.forEach((sibling)=>{if(hidden){if(!sibling.hasAttribute("aria-hidden")){sibling.setAttribute("aria-hidden","true");sibling.setAttribute("data-aria-hidden-by-modal","true")}}else{if(sibling.hasAttribute("data-aria-hidden-by-modal")){sibling.removeAttribute("aria-hidden");sibling.removeAttribute("data-aria-hidden-by-modal")}}})}}
export class Carousel{constructor(element){this.carousel=typeof element==="string"?document.querySelector(element):element;this.figure=this.carousel.querySelector('figure[role="group"]');this.slides=this.figure.querySelectorAll('[aria-roledescription="slide"]');this.index=0;this.carousel.setAttribute("aria-roledescription","carousel");this.carousel.setAttribute("aria-label",this.carousel.getAttribute("aria-label")||"Carousel");this._initIndicators();this._initKeyboardNavigation();this._initLiveRegion();this.show(0)}
_initIndicators(){this.indicatorsList=this.carousel.querySelector('[role="tablist"]');if(!this.indicatorsList){this.indicatorsList=document.createElement("ol");this.indicatorsList.setAttribute("role","tablist");this.indicatorsList.setAttribute("aria-label","Carousel slides");this.slides.forEach((_,i)=>{const btn=document.createElement("button");btn.setAttribute("role","tab");btn.setAttribute("aria-label",`Slide ${i + 1}`);btn.addEventListener("click",()=>this.show(i));const li=document.createElement("li");li.appendChild(btn);this.indicatorsList.appendChild(li)});this.carousel.appendChild(this.indicatorsList)}
this.indicatorButtons=this.indicatorsList.querySelectorAll('[role="tab"]')}
_initKeyboardNavigation(){this.carousel.addEventListener("keydown",(e)=>{if(e.key==="ArrowRight"){e.preventDefault();this.next()}else if(e.key==="ArrowLeft"){e.preventDefault();this.prev()}else if(e.key==="Home"){e.preventDefault();this.show(0)}else if(e.key==="End"){e.preventDefault();this.show(this.slides.length-1)}});const nextBtn=this.carousel.querySelector("[data-next]");const prevBtn=this.carousel.querySelector("[data-prev]");if(nextBtn){nextBtn.setAttribute("aria-label",nextBtn.getAttribute("aria-label")||"Next slide")}
if(prevBtn){prevBtn.setAttribute("aria-label",prevBtn.getAttribute("aria-label")||"Previous slide")}}
_initLiveRegion(){this.liveRegion=document.createElement("div");this.liveRegion.setAttribute("aria-live","polite");this.liveRegion.setAttribute("aria-atomic","true");this.liveRegion.className="sr-only";this.liveRegion.style.cssText="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0;";this.carousel.appendChild(this.liveRegion)}
show(i){this.index=Math.max(0,Math.min(i,this.slides.length-1));this.figure.style.transform=`translateX(-${this.index * 100}%)`;this.indicatorButtons.forEach((btn,n)=>{const active=n===this.index;btn.setAttribute("aria-selected",active);btn.tabIndex=active?0:-1});this.slides.forEach((slide,n)=>{if(n===this.index){slide.removeAttribute("aria-hidden");slide.removeAttribute("inert")}else{slide.setAttribute("aria-hidden","true");slide.setAttribute("inert","")}});const nextBtn=this.carousel.querySelector("[data-next]");const prevBtn=this.carousel.querySelector("[data-prev]");if(prevBtn)prevBtn.disabled=this.index===0;if(nextBtn)nextBtn.disabled=this.index===this.slides.length-1;this.liveRegion.textContent=`Slide ${this.index + 1} of ${this.slides.length}`}
next(){this.show(this.index+1)}
prev(){this.show(this.index-1)}}
export function initLumo(){document.addEventListener("click",(e)=>{const target=e.target;const openTrigger=target.closest("[data-target]");if(openTrigger){e.preventDefault();const modalId=openTrigger.dataset.target;const modalEl=document.getElementById(modalId);if(modalEl){openTrigger.setAttribute("aria-controls",modalId);openTrigger.setAttribute("aria-haspopup","dialog");const m=new Modal(modalEl);m.open()}}
const closeTrigger=target.closest("[data-close]");const openModalEl=document.querySelector("dialog[open]");if(openModalEl&&(closeTrigger||(target===openModalEl&&!openModalEl.hasAttribute("data-locked")))){new Modal(openModalEl).close()}
if(!target.closest("details.dropdown[open]")){document.querySelectorAll("details.dropdown[open]").forEach((d)=>d.removeAttribute("open"))}});document.addEventListener("keydown",(e)=>{if(e.key==="Escape"){const openModalEl=document.querySelector("dialog[open]");if(openModalEl&&!openModalEl.hasAttribute("data-locked")){new Modal(openModalEl).close()}}});document.querySelectorAll("article.tabs").forEach((el)=>{const tabs=el.querySelectorAll('[role="tab"]');const panels=el.querySelectorAll('[role="tabpanel"]');tabs.forEach((tab,i)=>{const panel=panels[i];if(!tab.id){tab.id=`tab-${Math.random().toString(36).substr(2, 9)}`}
if(!panel.id){panel.id=`panel-${Math.random().toString(36).substr(2, 9)}`}
if(!tab.hasAttribute("aria-controls")){tab.setAttribute("aria-controls",panel.id)}
if(!panel.hasAttribute("aria-labelledby")){panel.setAttribute("aria-labelledby",tab.id)}
tab.addEventListener("click",()=>{tabs.forEach((t)=>{t.setAttribute("aria-selected","false");t.tabIndex=-1});panels.forEach((p)=>p.setAttribute("hidden",""));tab.setAttribute("aria-selected","true");tab.tabIndex=0;panels[i].removeAttribute("hidden")});tab.addEventListener("keydown",(e)=>{let newIndex;if(e.key==="ArrowRight"){newIndex=(i+1)%tabs.length}else if(e.key==="ArrowLeft"){newIndex=(i-1+tabs.length)%tabs.length}else if(e.key==="Home"){newIndex=0}else if(e.key==="End"){newIndex=tabs.length-1}else{return}
e.preventDefault();tabs[newIndex].focus();tabs[newIndex].click()})})});document.querySelectorAll('[aria-roledescription="carousel"]').forEach((c)=>{const instance=new Carousel(c);c.querySelector("[data-next]")?.addEventListener("click",()=>instance.next());c.querySelector("[data-prev]")?.addEventListener("click",()=>instance.prev())});document.querySelectorAll("details.dropdown").forEach((dropdown)=>{const summary=dropdown.querySelector("summary");if(summary){summary.setAttribute("aria-haspopup","true");summary.setAttribute("aria-expanded",dropdown.hasAttribute("open"));dropdown.addEventListener("toggle",()=>{summary.setAttribute("aria-expanded",dropdown.hasAttribute("open"))})}})}